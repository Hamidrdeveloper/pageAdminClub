"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8045],{32117:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(50189),a=n(27378),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v584zM688 420h-55.2c-5.1 0-10 2.5-13 6.6L468.9 634.4l-64.7-89c-3-4.1-7.8-6.6-13-6.6H336c-6.5 0-10.3 7.4-6.5 12.7l126.4 174a16.1 16.1 0 0026 0l212.6-292.7c3.8-5.4 0-12.8-6.5-12.8z"}}]},name:"carry-out",theme:"outlined"},o=n(92788),l=function(e,t){return a.createElement(o.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:i}))};l.displayName="CarryOutOutlined";var c=a.forwardRef(l)},88866:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(50189),a=n(27378),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M531.3 574.4l.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7-3.8-21.3-19.5-29.6-32.9-30.2-15.8-.7-29.9 8.3-33.4 21.4-6.6 24-.7 56.8 10.1 98.6-13.6 32.4-35.3 79.5-51.2 107.5-29.6 15.3-69.3 38.9-75.2 68.7-1.2 5.5.2 12.5 3.5 18.8 3.7 7 9.6 12.4 16.5 15 3 1.1 6.6 2 10.8 2 17.6 0 46.1-14.2 84.1-79.4 5.8-1.9 11.8-3.9 17.6-5.9 27.2-9.2 55.4-18.8 80.9-23.1 28.2 15.1 60.3 24.8 82.1 24.8 21.6 0 30.1-12.8 33.3-20.5 5.6-13.5 2.9-30.5-6.2-39.6-13.2-13-45.3-16.4-95.3-10.2-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7 6.7-12.3 19.8-25.3 30.1-34.7zm87.6-235.5c5.2 8.9 4.5 35.8.5 49.4-4.9-19.9-5.6-48.1-2.7-51.4.8.1 1.5.7 2.2 2zm-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2-21.6 4.9-41.3 13-58.9 20.2-4.2 1.7-8.3 3.4-12.3 5 13.3-24.1 24.4-51.4 32.1-71.4zm155.6 65.5c.1.2.2.5-.4.9h-.2l-.2.3c-.8.5-9 5.3-44.3-8.6 40.6-1.9 45 7.3 45.1 7.4zm191.4-388.2L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-pdf",theme:"outlined"},o=n(92788),l=function(e,t){return a.createElement(o.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:i}))};l.displayName="FilePdfOutlined";var c=a.forwardRef(l)},28045:function(e,t,n){n.d(t,{Z:function(){return be}});n(34570);var r=n(61985),a=n(67312),i=n(10374),o=n(2133),l=n(35062),c=n(52395),d=n(95964),s=n(27378),u=n(60071),p=n(26761),m=n(97645),h=n(21244),v=n(20326),b=n(6110),g=n(72961),f=n(56591),P=n(25724),y=n(21329),k=n(97851),E=n(34940);n(3970),n(11483);const Z=(0,s.createContext)({barcode:"",barcodeType:"Order",orders:[],packages:[],products:[],selectedBox:null,selectedOrder:null,selectedProducts:[],packedPackages:[],spinning:"None",serialNumberVisible:{barcode:"",positionId:0,visible:!1},serialNumbers:[],setBarcode:()=>!1,setOrders:()=>!1,setPackages:()=>!1,setSpinning:()=>!1,setProducts:()=>!1,setBarcodeType:()=>!1,setSelectedBox:()=>!1,setSelectedOrder:()=>!1,setSelectedProducts:()=>!1,setPackedPackages:()=>!1,setSerialNumberVisible:()=>!1,setSerialNumbers:()=>!1});function _({children:e}){const[t,n]=(0,s.useState)("None"),[r,a]=(0,s.useState)({barcode:"",positionId:0,visible:!1}),[i,o]=(0,s.useState)(""),[l,c]=(0,s.useState)(null),[d,u]=(0,s.useState)(null),[p,m]=(0,s.useState)([]),[h,v]=(0,s.useState)(null),[b,g]=(0,s.useState)(null),[f,P]=(0,s.useState)([]),[y,k]=(0,s.useState)([]),[E,_]=(0,s.useState)("Order"),[x,N]=(0,s.useState)([]);return s.createElement(Z.Provider,{value:{spinning:t,setSpinning:n,orders:l,setOrders:c,packages:d,setPackages:u,products:p,setProducts:m,selectedOrder:h,setSelectedOrder:v,selectedBox:b,setSelectedBox:g,selectedProducts:y,setSelectedProducts:k,barcode:i,setBarcode:o,barcodeType:E,setBarcodeType:_,packedPackages:f,setPackedPackages:P,serialNumberVisible:r,setSerialNumberVisible:a,serialNumbers:x,setSerialNumbers:N}},e)}var x=n(14206),N=n.n(x),S=n(34234),w=n(22501),D=function(e,t,n,r){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):a(e.value).then(o,l)}c((r=r.apply(e,t||[])).next())}))};const C=new S.Vx("");function B(e,t){return D(this,void 0,void 0,(function*(){let n;try{n=yield N().get("/orders/packs",{signal:t,params:{ids:[e]}})}catch(n){return b.ZP.warn((0,w.t)("PackerDashboard.WaitResponse"))}return n.data.data}))}function O({slug:e,orderId:t}){return D(this,void 0,void 0,(function*(){return yield C.request({url:`/order-sales/${t}/update-status-by-slug`,method:"PUT",body:{slug:e}})}))}function I(e){return D(this,void 0,void 0,(function*(){return yield C.request({url:"serial-numbers/bulk-add",body:{items:e},method:"POST"})}))}var V=function(e,t,n,r){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):a(e.value).then(o,l)}c((r=r.apply(e,t||[])).next())}))};let q;function R(){const{barcode:e,setSpinning:t,setSelectedOrder:n,setProducts:r,setBarcode:a,setBarcodeType:i,packages:o,setSelectedBox:l,products:c,setSelectedProducts:d,setPackedPackages:p,selectedProducts:m,serialNumberVisible:h,setSerialNumberVisible:v,packedPackages:g}=(0,s.useContext)(Z),{t:f}=(0,u.$)();const P=e=>{var t,n;return(null!==(n=null===(t=m.find((t=>t.id===e)))||void 0===t?void 0:t.quantity)&&void 0!==n?n:0)+(null==g?void 0:g.flatMap((e=>e.packingJournalItems)).filter((t=>t.order_position_id==e)).reduce(((e,t)=>e+t.quantity),0))},y=()=>{const e=[];return c.filter((e=>0===e.children.length&&e.quantity>P(e.id))).map((t=>e.push(t))),c.filter((e=>0!==e.children.length)).flatMap((e=>e.children)).filter((e=>e.quantity>P(e.id))).map((t=>e.push(t))),e};function k(e){const t=y().find((({productVariation:{barcodes:t}})=>!!t.find((({value:t})=>t===e)))),n=m.find((n=>n.id===(null==t?void 0:t.id)&&n.productVariation.barcodes.some((t=>t.value===e))));t&&!n?(d((e=>[...e,Object.assign(Object.assign({},t),{quantity:1})])),a(""),i("Product"),b.ZP.success(f("PackerDashboard.ProductSelected"))):t&&n&&n.quantity<t.quantity&&(d((e=>e.map((e=>e.id===n.id?Object.assign(Object.assign({},n),{quantity:n.quantity+1}):e)))),a(""),i("Product"),b.ZP.success(f("PackerDashboard.ProductSelected")))}return{whenBarcodeTypeIsOrder:function(){return V(this,void 0,void 0,(function*(){q&&q.abort();if(e.length>=5){t("Order"),q=new AbortController;const o=yield B(e,q.signal);if(t("None"),o.length>0){const e=o[0].orderSalePositions;n(o[0]),r(e),a(""),i("Box"),t("All"),N().get(`/order-sales/${o[0].id}/packing`,{signal:q.signal}).then((({data:e})=>{p(null==e?void 0:e.data),t("None")})),b.ZP.success(f("PackerDashboard.OrderSelected"))}else b.ZP.error(f("PackerDashboard.OrderIsNotInPackingStatus"))}}))},whenBarcodeTypeIsBox:function(){const t=null==o?void 0:o.find((({id:t})=>String(t)===e));t&&(l(t),a(""),i("Product"),b.ZP.success(f("PackerDashboard.BoxSelected")))},whenBarcodeTypeIsProduct:function(t,n){var r;return V(this,void 0,void 0,(function*(){const a=e.length>=5;if(t&&n){const e=null!==(r=c.find((e=>e.id===n)))&&void 0!==r?r:c.filter((e=>0!==e.children.length)).flatMap((e=>e.children)).find((e=>e.id===n)),t=m.find((e=>e.id===n));e&&!t?d((t=>[...t,Object.assign(Object.assign({},e),{quantity:1})])):e&&t&&d((e=>e.map((e=>e.id===t.id?Object.assign(Object.assign({},t),{quantity:t.quantity+1}):e)))),i("Product"),b.ZP.success(f("PackerDashboard.ProductSelected"))}else if(a){const t=y().find((({productVariation:{barcodes:t}})=>!!t.find((({value:t})=>t===e))));if(void 0===t)return b.ZP.error(f("PackerDashboard.OnlyProductBarcode"));const n=m.find((({productVariation:{barcodes:t}})=>!!t.find((({value:t})=>t===e))));if(t&&!h.visible&&((null==t?void 0:t.productVariation.has_serial_number)||(null==n?void 0:n.productVariation.has_serial_number)))return void v({visible:!0,barcode:e,positionId:t.id});k(e)}}))},addProductExistance:k}}var T=function({image:e,title:t,number:n,quantity:r,isParent:a,maxQuantity:o,variationId:c,positionId:d,hasSerialNumber:p,onChange:_}){const[x,N]=s.useState(!1),[S,w]=(0,s.useState)(!1),[D,C]=s.useState(""),[B,O]=s.useState("variation"),{whenBarcodeTypeIsProduct:I}=R(),{barcodeType:V,serialNumbers:q,setSerialNumbers:T}=(0,s.useContext)(Z),{t:U}=(0,u.$)(),$=()=>{""!==D?(N(!1),q.find((e=>e.serialNumber===D))?(C(""),b.ZP.error(U("PackerDashboard.DuplicateSerialNumber"))):(T([...q,{serialNumber:D,positionId:d}]),"quantity"===B?(C(""),null==_||_((null!=r?r:0)+1)):(C(""),I(c,d)))):b.ZP.error(U("PackerDashboard.RequiredSerialNumber"))};return s.createElement(z,null,(null!=r?r:1)>0&&s.createElement(l.Z,{justify:"start",align:"middle"},s.createElement(i.Z,{span:4},s.createElement("img",{src:e,style:{width:"100%",objectFit:"contain"},onError:({currentTarget:e})=>{e.onerror=null,e.src="/assets/images/dashboard/box.png"}})),s.createElement(i.Z,{span:_?11:14,offset:1},s.createElement("h4",null,t),n&&s.createElement("h5",null,U("PackerDashboard.Number")," : ",n)),s.createElement(i.Z,{span:_?5:2,offset:1},_?s.createElement(g.Z,{direction:"horizontal"},s.createElement(f.Z,{size:"small",style:{height:32},onClick:()=>{p?w(!0):null==_||_(Number(r)-1)}},s.createElement(m.Z,null)),r&&s.createElement(P.Z,{step:1,value:r,max:null!=o?o:0,style:{minWidth:60,textAlign:"center"},onChange:e=>null==_?void 0:_(e)}),s.createElement(f.Z,{size:"small",style:{height:32},disabled:r===o,onClick:()=>(e=>{p?(N(!0),O("quantity")):null==_||_(e)})(Number(r)+1)},s.createElement(h.Z,null))):s.createElement("h4",null,s.createElement("b",null,r))),!_&&!a&&s.createElement(i.Z,{span:2},s.createElement(f.Z,{onClick:()=>{p?(N(!0),O("variation")):I(c,d)},icon:s.createElement(v.Z,null),disabled:"Product"!==V}))),s.createElement(y.Z,{destroyOnClose:!0,visible:x,onOk:$,onCancel:()=>{N(!1),C("")},title:U("PackerDashboard.ProductVariationSerialNumber")},s.createElement("div",null,s.createElement(k.Z,{value:D,placeholder:U("PackerDashboard.EnterSerialNumber"),onChange:e=>C(e.target.value),onKeyDown:e=>{"Enter"===e.code&&$()}}))),s.createElement(y.Z,{footer:null,destroyOnClose:!0,visible:S,onCancel:()=>w(!1),title:U("PackerDashboard.SelectSerialNumber")},q.map(((e,t)=>s.createElement(E.Z,{closable:!0,color:"magenta",key:`serial-${t}`,onClose:()=>(e=>{T(q.filter((t=>t.serialNumber!==e.serialNumber))),null==_||_(Number(r)-1),w(!1)})(e)},e.serialNumber)))))};const z=p.ZP.div`
  margin-bottom: 8px;

  & h4 {
    margin: 0;
  }

  & .ant-tag-magenta {
    font-size: 1rem !important;
    padding-block: 16px !important;

    & .ant-tag-close-icon {
      font-size: 1rem !important;
    }
  }
`,{Panel:U}=a.Z;var $=function({positions:e,orderId:t,selectedPositions:n,packages:p,isPending:m}){const{t:h}=(0,u.$)();return s.createElement(j,{align:"top",justify:"start"},s.createElement(i.Z,{span:24},s.createElement("h3",null,s.createElement("b",null,h("PackerDashboard.Order")," ",-1===t?"":`(${h("Global.ID")}: ${t})`))),e.length>0&&s.createElement(o.Z,{orientation:"left"},h("PackerDashboard.OrderPositions")),0===e.length?s.createElement(i.Z,{span:24,style:{paddingBlock:32}},s.createElement(l.Z,{justify:"center"},s.createElement(c.Z,{spinning:m},s.createElement(d.Z,{description:h("PackerDashboard.DoNotOrderSelected")})))):s.createElement(i.Z,{span:24},s.createElement(a.Z,{ghost:!0},e.filter((e=>2===e.order_position_type_id)).map((({id:e,productVariation:t,children:a})=>{var i;return s.createElement(s.Fragment,{key:e},n.filter((t=>t.parent_id===e)).reduce(((e,t)=>{var n;return null!==(n=e+t.quantity)&&void 0!==n?n:0}),0)+p.flatMap((e=>e.packingJournalItems)).filter((e=>{var t;return e.order_position_id===(null===(t=a.find((t=>t.id===e.order_position_id)))||void 0===t?void 0:t.id)})).reduce(((e,t)=>{var n;return null!==(n=e+t.quantity)&&void 0!==n?n:0}),0)!==a.reduce(((e,t)=>{var n;return null!==(n=e+t.quantity)&&void 0!==n?n:0}),0)&&s.createElement(U,{key:e,header:s.createElement(T,{isParent:!0,positionId:e,number:t.number,variationId:t.id,title:null!==(i=t.name)&&void 0!==i?i:h("PackerDashboard.NoData"),image:t.productVariationFiles.length>0?r.Xb.PURE_URL+t.productVariationFiles[0].link:""})},null==a?void 0:a.map((e=>{var t,a,i,o,l,c,d,u;return s.createElement(T,{positionId:e.id,key:`child-${e.id}`,number:e.productVariation.number,variationId:e.product_variation_id,title:null!==(a=null===(t=e.productVariation)||void 0===t?void 0:t.name)&&void 0!==a?a:h("PackerDashboard.NoName"),hasSerialNumber:null===(i=e.productVariation)||void 0===i?void 0:i.has_serial_number,image:(null===(o=e.productVariation.productVariationFiles)||void 0===o?void 0:o.length)>0?r.Xb.PURE_URL+(null===(l=e.productVariation.productVariationFiles[0])||void 0===l?void 0:l.link):"",quantity:(null!==(c=null==e?void 0:e.quantity)&&void 0!==c?c:0)-(null!==(u=null===(d=n.find((t=>t.id===e.id)))||void 0===d?void 0:d.quantity)&&void 0!==u?u:0)-p.flatMap((e=>e.packingJournalItems)).filter((t=>t.order_position_id==e.id)).reduce(((e,t)=>e+t.quantity),0)})}))),s.createElement("hr",null))})),e.filter((e=>null===e.parent_id&&e.productVariation&&2!==e.order_position_type_id&&3!==e.order_position_type_id)).map((e=>{var t,a,i,o,l,c;return s.createElement(T,{positionId:e.id,key:`product-${e.id}`,number:e.productVariation.number,variationId:e.product_variation_id,hasSerialNumber:null===(t=e.productVariation)||void 0===t?void 0:t.has_serial_number,image:e.productVariation.productVariationFiles.length>0?r.Xb.PURE_URL+e.productVariation.productVariationFiles[0].link:"",quantity:(null!==(a=null==e?void 0:e.quantity)&&void 0!==a?a:0)-(null!==(o=null===(i=n.find((t=>t.id===e.id)))||void 0===i?void 0:i.quantity)&&void 0!==o?o:0)-p.flatMap((e=>e.packingJournalItems)).filter((t=>t.order_position_id==e.id)).reduce(((e,t)=>e+t.quantity),0),title:null!==(c=null===(l=e.productVariation)||void 0===l?void 0:l.name)&&void 0!==c?c:h("PackerDashboard.NoName")})})))))};const j=(0,p.ZP)(l.Z)`
  & .ant-collapse-header {
    align-items: center !important;
  }
`;n(55088);var A=n(31675),L=n(5944);var F=function({products:e,onQuantityChanged:t,onAction:n,positions:a,packages:c}){var p;const{selectedBox:m}=(0,s.useContext)(Z),{t:h}=(0,u.$)(),v=e=>{var t,n,r,i;const o=null!==(r=null===(n=null!==(t=a.find((t=>t.id===e)))&&void 0!==t?t:a.filter((e=>0!==e.children.length)).flatMap((e=>e.children)).find((t=>t.id===e)))||void 0===n?void 0:n.quantity)&&void 0!==r?r:0,l=null!==(i=c.flatMap((e=>e.packingJournalItems)).filter((t=>t.order_position_id===e)).reduce(((e,t)=>e+t.quantity),0))&&void 0!==i?i:0;return o-l};return s.createElement(l.Z,{justify:"start",align:"top"},s.createElement(i.Z,{span:24},s.createElement("h3",null,s.createElement("b",null,h("PackerDashboard.Product"))," ",s.createElement("span",null,"(",function(e){var t;return e?`${null===(t=e.packingType)||void 0===t?void 0:t.name} - ${e.width} x ${e.height} x ${e.length} - ${(0,A.Xl)(e.net_weight)}`:" - "}(m),")")),s.createElement(L.Z,{src:"/assets/images/dashboard/open-box.png",preview:!1}),s.createElement(o.Z,{orientation:"left"},h("PackerDashboard.ProductsInformation"))),0===e.length&&s.createElement(i.Z,{span:24,style:{paddingBlock:32}},s.createElement(l.Z,{justify:"center"},s.createElement(d.Z,{description:h("PackerDashboard.DoNotProductSelected")}))),e.length>0&&s.createElement(i.Z,{span:24},e.reverse().map((({productVariationFiles:e,quantity:n,name:a,has_serial_number:i,number:o,positionId:l})=>{var c;return s.createElement(T,{key:l,title:a,number:o,quantity:n,positionId:l,hasSerialNumber:i,image:(null==e?void 0:e.length)>0?r.Xb.PURE_URL+(null===(c=e[0])||void 0===c?void 0:c.link):"",onChange:e=>t(e,l),maxQuantity:v(l)})})),s.createElement(o.Z,{orientation:"left"},h("PackerDashboard.TotalWeight")," : ",(0,A.Xl)(null!==(p=e.map((e=>{var t;return Number(e.weight_gross)*(null!==(t=e.quantity)&&void 0!==t?t:0)})).reduce(((e,t)=>e+t),0))&&void 0!==p?p:0))),e.length>0&&s.createElement(i.Z,{span:24,style:{padding:"8px 32px"}},s.createElement(l.Z,{justify:"center"},s.createElement(g.Z,{direction:"vertical",size:"middle"},s.createElement(f.Z,{block:!0,type:"primary",size:"large",onClick:()=>n("Close")},h("PackerDashboard.CloseBox")),s.createElement(f.Z,{block:!0,type:"primary",size:"large",onClick:()=>n("Close With Delivery")},h("PackerDashboard.CloseBoxShipping")),s.createElement(f.Z,{block:!0,type:"primary",size:"large",onClick:()=>n("Close With Shipping")},h("PackerDashboard.CloseBoxAndGenerateDelivery"))))))},X=n(88866),M=n(92555),H=n(32117),Q=n(54502),J=n(57091),W=n(46927),G=n(19511),K=n(99885);function Y({quantity:e,productVariation:t,id:n,order_position_type_id:r,parent_id:a}){return{quantity:e,product_variation_id:t.id,order_position_id:n,isActive:!0,name:null==t?void 0:t.name,order_position_type_id:r,parent_id:a}}var ee=function(e,t,n,r){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):a(e.value).then(o,l)}c((r=r.apply(e,t||[])).next())}))};function te(){const{setSelectedProducts:e,selectedOrder:t,selectedBox:n,selectedProducts:a,setSpinning:i,setBarcodeType:o,setSelectedBox:l,setPackages:c,setProducts:d,setOrders:u,setSelectedOrder:p,setPackedPackages:m,serialNumbers:h,setSerialNumbers:v}=(0,s.useContext)(Z);function b(){var e;return ee(this,void 0,void 0,(function*(){const r=a.map(Y);return yield(0,K.G0)(null!==(e=null==t?void 0:t.id)&&void 0!==e?e:-1,{package:null!=n?n:null,items:r}).then((e=>{h.length>0&&I(h.map((t=>({packing_journal_id:e.id,serial_number:t.serialNumber,order_sale_position_id:t.positionId})))).then((()=>{v([])})).catch((()=>v([])))}))}))}function g(n=null){t&&N().get(`/order-sales/${t.id}/packing`).then((({data:a})=>{"delivery"===n?(0,W.fm)(t.id,{invoice_type:"delivery_note"}).then((t=>{o("Box"),l(null),m(null==a?void 0:a.data),i("None"),e([]),window.open(r.Xb.PURE_URL+t,"_blank")})).catch((()=>i("None"))):"shipping"===n?(0,W.fm)(t.id,{invoice_type:"delivery_note"}).then((t=>{(0,W.xo)(null==a?void 0:a.data[(null==a?void 0:a.data.length)-1].id).then((e=>{window.open(r.Xb.PURE_URL+t,"_blank"),window.open(r.Xb.PURE_URL+e.labels.link,"_blank")})).catch((()=>{i("None"),window.open(r.Xb.PURE_URL+t,"_blank")})),o("Box"),l(null),m(null==a?void 0:a.data),i("None"),e([])})).catch((()=>i("None"))):(o("Box"),l(null),m(null==a?void 0:a.data),i("None"),e([]))})).catch((()=>i("None")))}return{onBoxAction:(e,r)=>{switch(e){case"Close":return void(t&&n&&a.length>0&&(i("All"),b().then((()=>g())).catch((()=>i("None")))));case"Close With Delivery":return void(t&&n&&a.length>0&&(i("All"),b().then((()=>g("delivery"))).catch((()=>i("None")))));case"Close With Shipping":return void(t&&n&&a.length>0&&(i("All"),b().then((()=>g("shipping"))).catch((()=>i("None")))));case"Remove":return function(e){e&&t&&(i("All"),(0,W.X4)(e).then((()=>{N().get(`/order-sales/${t.id}/packing`).then((({data:e})=>{i("None"),m(null==e?void 0:e.data)}))})).catch((()=>i("None"))))}(r)}},onQuantityChanged:(n,r)=>{n>0?e((e=>function(e,t,n){const r=e.findIndex((e=>e.id===t));return e[r]&&(e[r].quantity=n),[...e]}(e,r,n))):function(e,t,n){var r,a;const i=null===(r=n.selectedOrder)||void 0===r?void 0:r.orderSalePositions.find((t=>t.id===e));t<=(null!==(a=null==i?void 0:i.quantity)&&void 0!==a?a:1)&&n.setSelectedProducts((t=>function(e,t){return e=e.filter((e=>e.id!=t)),[...e]}(t,e)))}(r,n,{setSelectedProducts:e,selectedOrder:t})},onDoneClicked:function(){u(null),c(null),m([]),d([]),l(null),p(null),e([]),o("Order")}}}const{Panel:ne}=a.Z;var re=function({orderId:e,onDoneCompleted:t}){const[n,c]=(0,s.useState)("None"),{packedPackages:p,products:m,selectedOrder:h}=(0,s.useContext)(Z),{onBoxAction:v}=te(),{t:b}=(0,u.$)(),[P,y]=(0,s.useState)(-1);return s.createElement(l.Z,{justify:"start",align:"top"},s.createElement(i.Z,{span:24},s.createElement("h3",null,s.createElement("b",null,b("PackerDashboard.Summery")))),s.createElement(o.Z,null),0===p.length&&s.createElement(i.Z,{span:24,style:{paddingBlock:32}},s.createElement(l.Z,{justify:"center"},s.createElement(d.Z,{description:b("PackerDashboard.EmptyPackage")}))),null==p?void 0:p.map((({number:t,packingJournalItems:o,id:l},d)=>{var u;return s.createElement(i.Z,{span:24,key:`summery${d}`},s.createElement(a.Z,{ghost:!0,expandIconPosition:"right"},s.createElement(ne,{header:s.createElement(g.Z,null,s.createElement(L.Z,{width:24,height:24,preview:!1,src:"../../../assets/images/dashboard/box.png"}),s.createElement("span",null,null!==(u=null!=t?t:l)&&void 0!==u?u:b("PackerDashboard.NoName"))),key:"1",showArrow:!1,extra:s.createElement(g.Z,{className:"icons",direction:"horizontal",align:"center"},s.createElement(G.Z,{title:b("PackerDashboard.GeneratePacklistDocument")},s.createElement(X.Z,{spin:"PackList"===n&&P===d,onClick:e=>{e.stopPropagation(),c("PackList"),y(d),(0,W.vK)(l).then((e=>{y(-1),c("None"),window.open(r.Xb.PURE_URL+e)})).catch((()=>{y(-1),c("None")}))}})),s.createElement(G.Z,{title:b("PackerDashboard.GenerateDeliveryNote")},s.createElement(M.Z,{spin:"Delivery"===n&&P===d,onClick:t=>{t.stopPropagation(),c("Delivery"),y(d),(0,W.fm)(e,{invoice_type:"delivery_note"}).then((e=>{y(-1),c("None"),window.open(r.Xb.PURE_URL+e)})).catch((()=>{y(-1),c("None")}))}})),s.createElement(G.Z,{title:b("PackerDashboard.CreateShippingLabel")},s.createElement(H.Z,{spin:"Shipping"===n&&P===d,onClick:e=>{e.stopPropagation(),y(d),c("Shipping"),(0,W.xo)(l).then((e=>{y(-1),c("None"),window.open(r.Xb.PURE_URL+e.labels.link,"_blank")})).catch((()=>{y(-1),c("None")}))}})),s.createElement(G.Z,{title:b("PackerDashboard.RemovePacking")},s.createElement(Q.Z,{onClick:e=>{e.stopPropagation(),v("Remove",l)}})),s.createElement(J.Z,{id:"arrow"}))},s.createElement("div",{style:{padding:8}},o.map((e=>{var t;return s.createElement(T,{positionId:0,key:e.id,quantity:e.quantity,number:e.productVariation.number,title:null!==(t=e.productVariation.name)&&void 0!==t?t:b("PackerDashboard.NoName"),image:r.Xb.PURE_URL+e.productVariation.product.file})})))),s.createElement("hr",null)))})),h&&m.filter((e=>2!==e.order_position_type_id&&16!==e.order_position_type_id&&e.productVariation)).reduce(((e,t)=>e+t.quantity),0)+m.flatMap((e=>e.children)).reduce(((e,t)=>e+t.quantity),0)===p.reduce(((e,t)=>e+t.packingJournalItems.reduce(((e,t)=>e+t.quantity),0)),0)&&s.createElement(i.Z,{span:24},s.createElement(l.Z,{style:{padding:32}},s.createElement(f.Z,{block:!0,id:"done",size:"large",type:"primary",loading:"Done"===n,onClick:()=>{c("Done"),O({orderId:e,slug:"ready-to-ship"}).then((()=>{c("None"),t()})).catch((()=>c("None")))}},b("PackerDashboard.DonePacking")))))};var ae=function({onBoxAction:e,onQuantityChanged:t,onDoneCompleted:n}){var r,a,o,c,d;const{selectedOrder:u,selectedProducts:p,packedPackages:m,spinning:h}=(0,s.useContext)(Z);return s.createElement(l.Z,{className:"content",gutter:16},s.createElement(i.Z,{span:7,className:"packer-col"},s.createElement($,{packages:m,isPending:"Order"===h,orderId:null!==(r=null==u?void 0:u.id)&&void 0!==r?r:-1,selectedPositions:p,positions:null!==(a=null==u?void 0:u.orderSalePositions)&&void 0!==a?a:[]})),s.createElement(i.Z,{span:10,className:"packer-col"},s.createElement(F,{packages:m,onAction:e,positions:null!==(o=null==u?void 0:u.orderSalePositions)&&void 0!==o?o:[],products:null!==(c=null==p?void 0:p.map((({productVariation:e,quantity:t,weight_gross:n,id:r})=>Object.assign(Object.assign({},e),{quantity:t,weight_gross:n,positionId:r}))))&&void 0!==c?c:[],onQuantityChanged:t})),s.createElement(i.Z,{span:7,className:"packer-col"},s.createElement(re,{orderId:null!==(d=null==u?void 0:u.id)&&void 0!==d?d:-1,onDoneCompleted:n})))};var ie=function(e,t,n,r){function a(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):a(e.value).then(o,l)}c((r=r.apply(e,t||[])).next())}))};const oe=new S.Vx("/packages");function le(){return ie(this,void 0,void 0,(function*(){return yield(yield oe.getAll({pagination:{per_page:100}})).data}))}var ce=n(25885),de=n(97986);const{Step:se}=de.Z;var ue=function({barcodeValue:e,step:t,onBarcodeChange:n,onStepChanged:r}){const{t:a}=(0,u.$)();return s.createElement(l.Z,{justify:"start",align:"top"},s.createElement(g.Z,null,s.createElement(pe,{autoFocus:!0,placeholder:"Order"===t?a("PackerDashboard.OrderID"):"Box"===t?a("PackerDashboard.Box"):"Product"===t?a("PackerDashboard.ProductBarcode"):"",value:e,onChange:({target:{value:e}})=>n(e)}),s.createElement(de.Z,{progressDot:!0,direction:"horizontal",style:{marginTop:16},current:"Order"===t?0:"Box"===t?1:2,onChange:e=>r(0===e?"Order":1===e?"Box":"Product")},s.createElement(se,{title:a("PackerDashboard.Order")}),s.createElement(se,{title:a("PackerDashboard.Box")}),s.createElement(se,{title:a("PackerDashboard.Product")}))))};const pe=(0,p.ZP)(k.Z)`
  min-width: 220px;
`;function me(){const{barcodeType:e,barcode:t,setBarcode:n,setBarcodeType:r}=(0,s.useContext)(Z),{t:a}=(0,u.$)();return s.createElement(g.Z,{direction:"horizontal"},s.createElement("h2",null,s.createElement("b",null,a("PackerDashboard.PackerDashboard"))),s.createElement(ue,{step:e,barcodeValue:t,onBarcodeChange:e=>n(e),onStepChanged:e=>r(e)}))}var he;!function(e){e.Container=p.ZP.div`
    min-height: 100vh;
    background-color: #fefefe;
    border-radius: 8px;

    & .content,
    & .title {
      padding: 8px 16px;
    }

    & h2 {
      margin-bottom: 0 !important;
    }

    & hr {
      width: 100% !important;
    }

    & .ant-divider-vertical {
      height: auto;
    }

    & .ant-collapse-header,
    & .ant-collapse-content-box {
      padding: 0 !important;
    }

    & .ant-image-img {
      width: 100%;
      max-width: 200px;
      margin: auto !important;
    }

    & .ant-image {
      width: 100%;
    }

    & .packer-col:not(:first-child) {
      border-left: 1px solid rgba(0, 0, 0, 0.06);
    }

    & .icons {
      font-size: 18px;
    }

    & #arrow {
      transition: 0.3s ease-in-out;
    }

    & #arrow {
      transform: rotate(0deg);
    }

    & .ant-collapse-item.ant-collapse-item-active.ant-collapse-no-arrow {
      & #arrow {
        transform: rotate(-180deg);
      }
    }

    & .done-holder {
      height: 75%;
      display: flex;
      justify-content: center;
      align-items: end;

      & .done {
        margin-left: auto;
        width: 12vh;
      }
    }
  `}(he||(he={}));var ve=function(){const{packages:e,setPackages:t,barcodeType:n,barcode:r,spinning:a,serialNumberVisible:o,setSerialNumberVisible:d,serialNumbers:p,setSerialNumbers:m}=(0,s.useContext)(Z),{onQuantityChanged:h,onBoxAction:v,onDoneClicked:g}=te(),f=R(),P=function(){const{setBarcodeType:e,selectedProducts:t,selectedOrder:n,selectedBox:r,barcode:a}=(0,s.useContext)(Z),{t:i}=(0,u.$)();return{whenBarcodeTypeIsOrder:function(){n&&r&&(e("Product"),b.ZP.error(i("PackerDashboard.ChoseOrder")))},whenBarcodeTypeIsProduct:function(){n?null===r&&(b.ZP.error(i("PackerDashboard.ChoseBoxFirst")),e("Box")):(b.ZP.error(i("PackerDashboard.ChoseOrderFirst")),e("Order"))},whenBarcodeTypeIsBox:function(){n?t.length>0&&a&&""!==a&&(b.ZP.error(i("PackerDashboard.ChoseBox")),e("Product")):b.ZP.error(i("PackerDashboard.ChoseOrderFirst"))}}}(),[E,_]=(0,s.useState)(""),{t:x}=(0,u.$)();return(0,s.useEffect)((()=>{if(""!==r)switch(n){case"Order":return f.whenBarcodeTypeIsOrder();case"Box":return f.whenBarcodeTypeIsBox();case"Product":return f.whenBarcodeTypeIsProduct()}}),[r]),(0,s.useEffect)((()=>{if(n)switch(n){case"Order":return P.whenBarcodeTypeIsOrder();case"Box":return P.whenBarcodeTypeIsBox();case"Product":return P.whenBarcodeTypeIsProduct()}}),[n]),s.createElement(s.Fragment,null,s.createElement(c.Z,{spinning:"All"===a},s.createElement(he.Container,null,s.createElement(ce.Z,{data:[e,t],service:le},s.createElement(l.Z,null,s.createElement(i.Z,{span:24,className:"title"},s.createElement(me,null)),s.createElement("hr",null),s.createElement(i.Z,{span:24},s.createElement(ae,{onBoxAction:v,onDoneCompleted:g,onQuantityChanged:h})))))),s.createElement(y.Z,{onOk:()=>{f.addProductExistance(o.barcode),m([...p,{serialNumber:E,positionId:o.positionId}]),d({visible:!1,barcode:"",positionId:0}),_("")},visible:o.visible,title:x("PackerDashboard.ProductVariationSerialNumber"),onCancel:()=>d({visible:!1,barcode:"",positionId:0})},s.createElement("div",null,s.createElement(k.Z,{value:E,placeholder:x("PackerDashboard.EnterSerialNumber"),onChange:e=>_(e.target.value)}))))};var be=()=>s.createElement(_,null,s.createElement(ve,null))}}]);